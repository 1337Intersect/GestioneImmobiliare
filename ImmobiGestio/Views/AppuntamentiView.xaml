<UserControl x:Class="ImmobiGestio.Views.AppuntamentiView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             mc:Ignorable="d"
             d:DesignHeight="700" d:DesignWidth="1400"
             Background="#F3F2F1">

    <UserControl.Resources>
        <!-- Tutti gli stili esistenti... mantieni quelli attuali -->
        <Style x:Key="FilterButton" TargetType="Button">
            <Setter Property="Background" Value="White"/>
            <Setter Property="BorderBrush" Value="#E1DFDD"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Padding" Value="12,6"/>
            <Setter Property="Margin" Value="0,0,8,0"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="FontSize" Value="12"/>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="#F8F8F8"/>
                </Trigger>
            </Style.Triggers>
        </Style>
    </UserControl.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- Outlook-style Ribbon Toolbar -->
        <Border Grid.Row="0" Background="White" BorderBrush="#E1DFDD" BorderThickness="0,0,0,1" Padding="16,12">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <!-- Left side - Main actions -->
                <StackPanel Grid.Column="0" Orientation="Horizontal" VerticalAlignment="Center" Margin="16,0">
                    <Button Content="📅 Nuovo evento" 
                            Command="{Binding AddAppuntamentoCommand}"
                            Background="#0078D4"
                            Foreground="White"
                            FontWeight="SemiBold"
                            Margin="0,0,12,0"
                            Padding="16,10"
                            Style="{StaticResource OutlookToolbarButton}"/>

                    <Rectangle Width="1" Height="30" Fill="#E1DFDD" Margin="8,0"/>

                    <Button Content="💾 Salva" 
                            Command="{Binding SaveAppuntamentoCommand}"
                            Style="{StaticResource OutlookToolbarButton}"/>

                    <Button Content="🗑️ Elimina" 
                            Command="{Binding DeleteAppuntamentoCommand}"
                            Style="{StaticResource OutlookToolbarButton}"/>

                    <Rectangle Width="1" Height="30" Fill="#E1DFDD" Margin="8,0"/>

                    <Button Content="✅ Conferma" 
                            Command="{Binding ConfermaAppuntamentoCommand}"
                            Style="{StaticResource OutlookToolbarButton}"/>

                    <Button Content="✔️ Completa" 
                            Command="{Binding CompletaAppuntamentoCommand}"
                            Style="{StaticResource OutlookToolbarButton}"/>

                    <Rectangle Width="1" Height="30" Fill="#E1DFDD" Margin="8,0"/>

                    <Button Content="🔄 Aggiorna" 
                            Command="{Binding RefreshCommand}"
                            Style="{StaticResource OutlookToolbarButton}"/>
                </StackPanel>

                <!-- Right side - Search and Filters -->
                <StackPanel Grid.Column="1" Orientation="Horizontal" VerticalAlignment="Center" Margin="16,0">
                    <ComboBox Width="120" 
                              SelectedItem="{Binding FiltroTipo, Mode=TwoWay}"
                              ItemsSource="{Binding TipiAppuntamentoFiltro}"
                              Style="{StaticResource OutlookFormComboBox}"
                              Margin="0,0,8,0"
                              VerticalAlignment="Center"
                              Height="32"/>

                    <ComboBox Width="120" 
                              SelectedItem="{Binding FiltroStato, Mode=TwoWay}"
                              ItemsSource="{Binding StatiAppuntamentoFiltro}"
                              Style="{StaticResource OutlookFormComboBox}"
                              Margin="0,0,8,0"
                              VerticalAlignment="Center"
                              Height="32"/>

                    <TextBox Width="200" 
                             Text="{Binding SearchText, UpdateSourceTrigger=PropertyChanged}"
                             Style="{StaticResource OutlookFormTextBox}"
                             Margin="0,0,0,0"
                             VerticalAlignment="Center"
                             Height="32"
                             ToolTip="Cerca eventi..."/>

                    <Button Content="🔍" 
                            Style="{StaticResource OutlookToolbarButton}"
                            Width="32" Height="32"
                            Margin="4,0,0,0"/>
                </StackPanel>
            </Grid>
        </Border>

        <!-- Calendar Navigation -->
        <Border Grid.Row="1" Background="#F8F8F8" BorderBrush="#E1DFDD" BorderThickness="0,0,0,1">
            <Grid Height="50">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <StackPanel Grid.Column="0" Orientation="Horizontal" VerticalAlignment="Center" Margin="16,0">
                    <Button Content="◀" 
                            Command="{Binding PreviousPeriodCommand}"
                            Style="{StaticResource OutlookToolbarButton}"
                            FontSize="16"
                            Width="36"
                            Height="36"/>
                    <Button Content="▶" 
                            Command="{Binding NextPeriodCommand}"
                            Style="{StaticResource OutlookToolbarButton}"
                            FontSize="16"
                            Width="36"
                            Height="36"
                            Margin="4,0,0,0"/>
                </StackPanel>

                <TextBlock Grid.Column="1" 
                           Text="{Binding TitoloVista}"
                           FontSize="18"
                           FontWeight="SemiBold"
                           VerticalAlignment="Center"
                           HorizontalAlignment="Center"
                           Foreground="#323130"/>

                <StackPanel Grid.Column="2" Orientation="Horizontal" VerticalAlignment="Center" Margin="0,0,16,0">
                    <Button Content="Oggi" 
                            Command="{Binding TodayCommand}"
                            Background="#0078D4"
                            Foreground="White"
                            Padding="12,8"
                            Style="{StaticResource OutlookToolbarButton}"/>

                    <ComboBox Width="100"
                              SelectedItem="{Binding VistaCalendario, Mode=TwoWay}"
                              Style="{StaticResource OutlookFormComboBox}"
                              VerticalAlignment="Center"
                              Height="32"
                              Margin="8,0,0,0">
                        <ComboBoxItem Content="Giorno"/>
                        <ComboBoxItem Content="Settimana"/>
                        <ComboBoxItem Content="Mese" IsSelected="True"/>
                    </ComboBox>
                </StackPanel>
            </Grid>
        </Border>

        <!-- Main Content Area -->
        <Grid Grid.Row="2">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="250"/>
                <ColumnDefinition Width="5"/>
                <ColumnDefinition Width="2*"/>
                <ColumnDefinition Width="5"/>
                <ColumnDefinition Width="1*"/>
            </Grid.ColumnDefinitions>

            <!-- Left Sidebar - Mini Calendar + Quick Views -->
            <Border Grid.Column="0" Background="White" BorderBrush="#E1DFDD" BorderThickness="0,0,1,0">
                <ScrollViewer VerticalScrollBarVisibility="Auto">
                    <StackPanel Margin="16">

                        <!-- Mini Calendar -->
                        <TextBlock Text="{Binding SelectedDate, StringFormat='MMMM yyyy'}" 
                                   FontSize="14" 
                                   FontWeight="SemiBold" 
                                   Foreground="#323130" 
                                   HorizontalAlignment="Center"
                                   Margin="0,0,0,8"/>

                        <!-- Navigation per mini calendar -->
                        <Grid Margin="0,0,0,8">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>

                            <Button Grid.Column="1" Content="◀" 
                                    Command="{Binding PreviousPeriodCommand}"
                                    Width="20" Height="20" FontSize="10"
                                    Style="{StaticResource MiniCalendarDay}"/>
                            <Button Grid.Column="2" Content="▶" 
                                    Command="{Binding NextPeriodCommand}"
                                    Width="20" Height="20" FontSize="10"
                                    Margin="4,0,0,0"
                                    Style="{StaticResource MiniCalendarDay}"/>
                        </Grid>

                        <!-- Days headers -->
                        <Grid Margin="0,0,0,4">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>

                            <TextBlock Grid.Column="0" Text="D" HorizontalAlignment="Center" FontSize="10" Foreground="#8A8886" FontWeight="SemiBold"/>
                            <TextBlock Grid.Column="1" Text="L" HorizontalAlignment="Center" FontSize="10" Foreground="#8A8886" FontWeight="SemiBold"/>
                            <TextBlock Grid.Column="2" Text="M" HorizontalAlignment="Center" FontSize="10" Foreground="#8A8886" FontWeight="SemiBold"/>
                            <TextBlock Grid.Column="3" Text="M" HorizontalAlignment="Center" FontSize="10" Foreground="#8A8886" FontWeight="SemiBold"/>
                            <TextBlock Grid.Column="4" Text="G" HorizontalAlignment="Center" FontSize="10" Foreground="#8A8886" FontWeight="SemiBold"/>
                            <TextBlock Grid.Column="5" Text="V" HorizontalAlignment="Center" FontSize="10" Foreground="#8A8886" FontWeight="SemiBold"/>
                            <TextBlock Grid.Column="6" Text="S" HorizontalAlignment="Center" FontSize="10" Foreground="#8A8886" FontWeight="SemiBold"/>
                        </Grid>

                        <!-- Calendar days - Dinamico -->
                        <ItemsControl x:Name="MiniCalendarDays">
                            <ItemsControl.ItemsPanel>
                                <ItemsPanelTemplate>
                                    <UniformGrid Columns="7" Rows="6"/>
                                </ItemsPanelTemplate>
                            </ItemsControl.ItemsPanel>
                            <ItemsControl.ItemTemplate>
                                <DataTemplate>
                                    <Button Content="{Binding Day}"
                                            Command="{Binding DataContext.SelectDateCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                            CommandParameter="{Binding Date}"
                                            Style="{StaticResource MiniCalendarDayDynamic}"/>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>

                        <!-- Separator -->
                        <Border Height="1" Background="#E1DFDD" Margin="0,20,0,16"/>

                        <!-- Today's Agenda -->
                        <TextBlock Text="Agenda di oggi" 
                                   FontSize="14" 
                                   FontWeight="SemiBold" 
                                   Foreground="#323130" 
                                   Margin="0,0,0,12"/>

                        <ItemsControl ItemsSource="{Binding AppuntamentiOggiCollection}">
                            <ItemsControl.ItemTemplate>
                                <DataTemplate>
                                    <Border Background="{Binding StatoColore}"
                                            CornerRadius="4" 
                                            Margin="0,0,0,4"
                                            Padding="8,4"
                                            Cursor="Hand">
                                        <Border.InputBindings>
                                            <MouseBinding MouseAction="LeftDoubleClick" 
                                                          Command="{Binding DataContext.SelectAppuntamentoCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                                          CommandParameter="{Binding}"/>
                                        </Border.InputBindings>
                                        <StackPanel>
                                            <TextBlock Text="{Binding Titolo}" 
                                                       Foreground="White" 
                                                       FontSize="11" 
                                                       FontWeight="SemiBold"
                                                       TextTrimming="CharacterEllipsis"/>
                                            <TextBlock Text="{Binding DataInizio, StringFormat=HH:mm}" 
                                                       Foreground="White" 
                                                       FontSize="10"/>
                                            <TextBlock Text="{Binding TipoAppuntamento}" 
                                                       Foreground="White" 
                                                       FontSize="9"
                                                       Opacity="0.8"/>
                                        </StackPanel>
                                    </Border>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>

                        <!-- Empty state quando non ci sono appuntamenti oggi -->
                        <StackPanel>
                            <StackPanel.Style>
                                <Style TargetType="StackPanel">
                                    <Setter Property="Visibility" Value="Collapsed"/>
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding AppuntamentiOggiCollection.Count}" Value="0">
                                            <Setter Property="Visibility" Value="Visible"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </StackPanel.Style>
                            <TextBlock Text="Nessun appuntamento oggi" 
                                       FontSize="11" 
                                       Foreground="#8A8886" 
                                       FontStyle="Italic"
                                       HorizontalAlignment="Center"/>
                        </StackPanel>

                        <!-- Filtri rapidi -->
                        <Border Height="1" Background="#E1DFDD" Margin="0,20,0,16"/>

                        <TextBlock Text="Filtri rapidi" 
                                   FontSize="14" 
                                   FontWeight="SemiBold" 
                                   Foreground="#323130" 
                                   Margin="0,0,0,12"/>

                        <StackPanel>
                            <Button Content="📅 Tutti" 
                                    Command="{Binding ClearFiltriCommand}"
                                    HorizontalAlignment="Stretch"
                                    HorizontalContentAlignment="Left"
                                    Margin="0,0,0,4"
                                    Style="{StaticResource OutlookToolbarButton}"/>

                            <Button Content="🏠 Solo visite" 
                                    Command="{Binding SetFiltroTipoCommand}"
                                    CommandParameter="Visita"
                                    HorizontalAlignment="Stretch"
                                    HorizontalContentAlignment="Left"
                                    Margin="0,0,0,4"
                                    Style="{StaticResource OutlookToolbarButton}"/>

                            <Button Content="🤝 Solo incontri" 
                                    Command="{Binding SetFiltroTipoCommand}"
                                    CommandParameter="Incontro"
                                    HorizontalAlignment="Stretch"
                                    HorizontalContentAlignment="Left"
                                    Margin="0,0,0,4"
                                    Style="{StaticResource OutlookToolbarButton}"/>

                            <Button Content="✅ Completati" 
                                    Command="{Binding SetFiltroStatoCommand}"
                                    CommandParameter="Completato"
                                    HorizontalAlignment="Stretch"
                                    HorizontalContentAlignment="Left"
                                    Margin="0,0,0,4"
                                    Style="{StaticResource OutlookToolbarButton}"/>

                            <Button Content="⏳ In attesa" 
                                    Command="{Binding SetFiltroStatoCommand}"
                                    CommandParameter="Programmato"
                                    HorizontalAlignment="Stretch"
                                    HorizontalContentAlignment="Left"
                                    Style="{StaticResource OutlookToolbarButton}"/>
                        </StackPanel>

                        <!-- Statistiche rapide -->
                        <Border Height="1" Background="#E1DFDD" Margin="0,20,0,16"/>

                        <TextBlock Text="Statistiche" 
                                   FontSize="14" 
                                   FontWeight="SemiBold" 
                                   Foreground="#323130" 
                                   Margin="0,0,0,12"/>

                        <StackPanel>
                            <Grid Margin="0,0,0,8">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                <TextBlock Grid.Column="0" Text="Oggi:" FontSize="12" Foreground="#605E5C"/>
                                <TextBlock Grid.Column="1" Text="{Binding AppuntamentiOggi}" FontSize="12" FontWeight="Bold" Foreground="#0078D4"/>
                            </Grid>

                            <Grid Margin="0,0,0,8">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                <TextBlock Grid.Column="0" Text="Completati:" FontSize="12" Foreground="#605E5C"/>
                                <TextBlock Grid.Column="1" Text="{Binding AppuntamentiCompletati}" FontSize="12" FontWeight="Bold" Foreground="#107C10"/>
                            </Grid>

                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                <TextBlock Grid.Column="0" Text="Totali:" FontSize="12" Foreground="#605E5C"/>
                                <TextBlock Grid.Column="1" Text="{Binding Appuntamenti.Count}" FontSize="12" FontWeight="Bold" Foreground="#323130"/>
                            </Grid>
                        </StackPanel>

                    </StackPanel>
                </ScrollViewer>
            </Border>

            <GridSplitter Grid.Column="1" HorizontalAlignment="Stretch" Background="#E1DFDD"/>

            <!-- Main Calendar View -->
            <Border Grid.Column="2" Background="White">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <!-- Calendar Headers -->
                    <Border Grid.Row="0" Background="#F8F8F8" Height="40" BorderBrush="#E1DFDD" BorderThickness="0,0,0,1">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>

                            <TextBlock Grid.Column="0" Text="Domenica" HorizontalAlignment="Center" VerticalAlignment="Center" FontWeight="SemiBold" FontSize="13" Foreground="#323130"/>
                            <TextBlock Grid.Column="1" Text="Lunedì" HorizontalAlignment="Center" VerticalAlignment="Center" FontWeight="SemiBold" FontSize="13" Foreground="#323130"/>
                            <TextBlock Grid.Column="2" Text="Martedì" HorizontalAlignment="Center" VerticalAlignment="Center" FontWeight="SemiBold" FontSize="13" Foreground="#323130"/>
                            <TextBlock Grid.Column="3" Text="Mercoledì" HorizontalAlignment="Center" VerticalAlignment="Center" FontWeight="SemiBold" FontSize="13" Foreground="#323130"/>
                            <TextBlock Grid.Column="4" Text="Giovedì" HorizontalAlignment="Center" VerticalAlignment="Center" FontWeight="SemiBold" FontSize="13" Foreground="#323130"/>
                            <TextBlock Grid.Column="5" Text="Venerdì" HorizontalAlignment="Center" VerticalAlignment="Center" FontWeight="SemiBold" FontSize="13" Foreground="#323130"/>
                            <TextBlock Grid.Column="6" Text="Sabato" HorizontalAlignment="Center" VerticalAlignment="Center" FontWeight="SemiBold" FontSize="13" Foreground="#323130"/>
                        </Grid>
                    </Border>

                    <!-- Calendar Grid e Lista Appuntamenti con visibilità alternata -->
                    <Grid Grid.Row="1">
                        <!-- Vista Mese - Calendario -->
                        <ScrollViewer VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Disabled">
                            <ScrollViewer.Style>
                                <Style TargetType="ScrollViewer">
                                    <Setter Property="Visibility" Value="Visible"/>
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding VistaCalendario}" Value="Giorno">
                                            <Setter Property="Visibility" Value="Collapsed"/>
                                        </DataTrigger>
                                        <DataTrigger Binding="{Binding VistaCalendario}" Value="Settimana">
                                            <Setter Property="Visibility" Value="Collapsed"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </ScrollViewer.Style>

                            <ItemsControl x:Name="CalendarGrid" ItemsSource="{Binding CalendarDays}">
                                <ItemsControl.ItemsPanel>
                                    <ItemsPanelTemplate>
                                        <UniformGrid Columns="7" Rows="6"/>
                                    </ItemsPanelTemplate>
                                </ItemsControl.ItemsPanel>
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate>
                                        <Border Style="{StaticResource CalendarCell}" Background="{Binding BackgroundColor}">
                                            <Border.InputBindings>
                                                <MouseBinding MouseAction="LeftDoubleClick" 
                              Command="{Binding DataContext.AddAppuntamentoCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"/>
                                            </Border.InputBindings>

                                            <Grid>
                                                <Grid.RowDefinitions>
                                                    <RowDefinition Height="Auto"/>
                                                    <RowDefinition Height="*"/>
                                                </Grid.RowDefinitions>

                                                <!-- Numero del giorno - CORRETTO -->
                                                <TextBlock Grid.Row="0" 
                           Text="{Binding DayNumber}" 
                           FontSize="14" 
                           FontWeight="{Binding FontWeight, Converter={StaticResource StringToFontWeightConverter}}" 
                           Foreground="{Binding ForegroundColor}" 
                           HorizontalAlignment="Left"
                           Margin="6,4,0,0"/>

                                                <!-- Eventi del giorno - CORRETTO -->
                                                <StackPanel Grid.Row="1" Margin="4,8,4,4" VerticalAlignment="Top">
                                                    <ItemsControl ItemsSource="{Binding Events}">
                                                        <ItemsControl.ItemTemplate>
                                                            <DataTemplate>
                                                                <!-- Border principale dell'evento SEMPLIFICATO -->
                                                                <Border x:Name="EventBorder" 
                                        CornerRadius="3" 
                                        Padding="4,2" 
                                        Margin="0,1"
                                        Cursor="Hand"
                                        BorderThickness="0"
                                        BorderBrush="Transparent">

                                                                    <!-- Background dinamico basato sullo stato -->
                                                                    <Border.Background>
                                                                        <SolidColorBrush Color="{Binding StatoColore, Converter={StaticResource HexToColorConverter}}"/>
                                                                    </Border.Background>

                                                                    <!-- Gestione eventi mouse SEMPLIFICATA -->
                                                                    <Border.InputBindings>
                                                                        <MouseBinding MouseAction="LeftClick" 
                                                      Command="{Binding DataContext.SelectAppuntamentoInCalendarCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                                      CommandParameter="{Binding}"/>
                                                                        <MouseBinding MouseAction="LeftDoubleClick" 
                                                      Command="{Binding DataContext.EditAppuntamentoCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                                      CommandParameter="{Binding}"/>
                                                                    </Border.InputBindings>

                                                                    <!-- Contenuto evento -->
                                                                    <StackPanel>
                                                                        <TextBlock Text="{Binding Titolo}" 
                                                   Foreground="White" 
                                                   FontSize="9" 
                                                   FontWeight="SemiBold"
                                                   TextTrimming="CharacterEllipsis"/>
                                                                        <TextBlock Text="{Binding DataInizio, StringFormat=HH:mm}" 
                                                   Foreground="White" 
                                                   FontSize="8"
                                                   Opacity="0.9"/>
                                                                    </StackPanel>

                                                                    <!-- Trigger semplici per mouse over -->
                                                                    <Border.Style>
                                                                        <Style TargetType="Border">
                                                                            <Style.Triggers>
                                                                                <Trigger Property="IsMouseOver" Value="True">
                                                                                    <Setter Property="Opacity" Value="0.8"/>
                                                                                </Trigger>
                                                                            </Style.Triggers>
                                                                        </Style>
                                                                    </Border.Style>
                                                                </Border>
                                                            </DataTemplate>
                                                        </ItemsControl.ItemTemplate>
                                                    </ItemsControl>

                                                    <!-- Indicatore overflow SEMPLIFICATO -->
                                                    <Border Background="#8A8886" 
                            CornerRadius="3" 
                            Padding="4,2" 
                            Margin="0,1"
                            HorizontalAlignment="Center">
                                                        <Border.Style>
                                                            <Style TargetType="Border">
                                                                <Setter Property="Visibility" Value="Collapsed"/>
                                                                <Style.Triggers>
                                                                    <DataTrigger Binding="{Binding HasOverflow}" Value="True">
                                                                        <Setter Property="Visibility" Value="Visible"/>
                                                                    </DataTrigger>
                                                                </Style.Triggers>
                                                            </Style>
                                                        </Border.Style>

                                                        <TextBlock Text="{Binding OverflowCount, StringFormat='+{0} altri'}" 
                                   FontSize="8" 
                                   Foreground="White" 
                                   FontWeight="SemiBold"
                                   HorizontalAlignment="Center"/>
                                                    </Border>
                                                </StackPanel>
                                            </Grid>
                                        </Border>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>
                        </ScrollViewer>

                        <!-- Vista Giorno/Settimana - Lista Appuntamenti -->
                        <ScrollViewer x:Name="AppuntamentiListView" VerticalScrollBarVisibility="Auto">
                            <ScrollViewer.Style>
                                <Style TargetType="ScrollViewer">
                                    <Setter Property="Visibility" Value="Collapsed"/>
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding VistaCalendario}" Value="Giorno">
                                            <Setter Property="Visibility" Value="Visible"/>
                                        </DataTrigger>
                                        <DataTrigger Binding="{Binding VistaCalendario}" Value="Settimana">
                                            <Setter Property="Visibility" Value="Visible"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </ScrollViewer.Style>

                            <ItemsControl ItemsSource="{Binding Appuntamenti}" Margin="16">
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate>
                                        <Border Background="White" 
        BorderBrush="#E1DFDD" 
        BorderThickness="1" 
        CornerRadius="6" 
        Margin="0,0,0,8" 
        Padding="16"
        Cursor="Hand"
        x:Name="AppuntamentoCard">

                                            <!-- Effetto ombra di base -->
                                            <Border.Effect>
                                                <DropShadowEffect Color="#000000" Opacity="0.1" ShadowDepth="2" BlurRadius="8"/>
                                            </Border.Effect>

                                            <!-- RenderTransform per animazioni -->
                                            <Border.RenderTransform>
                                                <ScaleTransform ScaleX="1" ScaleY="1"/>
                                            </Border.RenderTransform>
                                            <Border.RenderTransformOrigin>
                                                <Point X="0.5" Y="0.5"/>
                                            </Border.RenderTransformOrigin>

                                            <!-- Gestione eventi CORRETTA per la lista -->
                                            <Border.InputBindings>
                                                <!-- Single click per selezione -->
                                                <MouseBinding MouseAction="LeftClick" 
                      Command="{Binding DataContext.SelectAppuntamentoInCalendarCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                      CommandParameter="{Binding}"/>
                                                <!-- Double click per modifica -->
                                                <MouseBinding MouseAction="LeftDoubleClick" 
                      Command="{Binding DataContext.EditAppuntamentoCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                      CommandParameter="{Binding}"/>
                                            </Border.InputBindings>

                                            <!-- Il contenuto della card rimane lo stesso... -->
                                            <Grid>
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="Auto"/>
                                                    <ColumnDefinition Width="*"/>
                                                    <ColumnDefinition Width="Auto"/>
                                                </Grid.ColumnDefinitions>

                                                <!-- Indicatore colore e orario -->
                                                <StackPanel Grid.Column="0" Margin="0,0,16,0">
                                                    <Border Width="4" Height="40" Background="{Binding StatoColore}" CornerRadius="2"/>
                                                    <TextBlock Text="{Binding DataInizio, StringFormat=HH:mm}" 
                       FontSize="12" 
                       FontWeight="Bold" 
                       Foreground="#323130" 
                       HorizontalAlignment="Center"
                       Margin="0,4,0,0"/>
                                                    <TextBlock Text="{Binding DataFine, StringFormat=HH:mm}" 
                       FontSize="10" 
                       Foreground="#8A8886" 
                       HorizontalAlignment="Center"/>
                                                </StackPanel>

                                                <!-- Contenuto principale -->
                                                <StackPanel Grid.Column="1">
                                                    <TextBlock Text="{Binding Titolo}" 
                       FontSize="16" 
                       FontWeight="SemiBold" 
                       Foreground="#323130"
                       TextWrapping="Wrap"/>

                                                    <TextBlock Text="{Binding Descrizione}" 
                       FontSize="13" 
                       Foreground="#605E5C" 
                       TextWrapping="Wrap"
                       Margin="0,4,0,0">
                                                        <TextBlock.Style>
                                                            <Style TargetType="TextBlock">
                                                                <Style.Triggers>
                                                                    <DataTrigger Binding="{Binding Descrizione}" Value="">
                                                                        <Setter Property="Visibility" Value="Collapsed"/>
                                                                    </DataTrigger>
                                                                </Style.Triggers>
                                                            </Style>
                                                        </TextBlock.Style>
                                                    </TextBlock>

                                                    <StackPanel Orientation="Horizontal" Margin="0,8,0,0">
                                                        <Border Background="#E3F2FD" CornerRadius="3" Padding="6,2" Margin="0,0,8,0">
                                                            <TextBlock Text="{Binding TipoAppuntamento}" FontSize="11" Foreground="#0078D4"/>
                                                        </Border>
                                                        <Border Background="#F0F0F0" CornerRadius="3" Padding="6,2" Margin="0,0,8,0">
                                                            <TextBlock Text="{Binding StatoAppuntamento}" FontSize="11" Foreground="#323130"/>
                                                        </Border>
                                                        <Border Background="#FFF3E0" CornerRadius="3" Padding="6,2" Margin="0,0,8,0">
                                                            <TextBlock Text="{Binding Priorita}" FontSize="11" Foreground="#F57C00"/>
                                                        </Border>
                                                    </StackPanel>

                                                    <StackPanel Orientation="Horizontal" Margin="0,8,0,0">
                                                        <TextBlock Text="📍" FontSize="12" Margin="0,0,4,0"/>
                                                        <TextBlock Text="{Binding Luogo}" FontSize="12" Foreground="#605E5C"/>

                                                        <TextBlock Text="👤" FontSize="12" Margin="16,0,4,0">
                                                            <TextBlock.Style>
                                                                <Style TargetType="TextBlock">
                                                                    <Style.Triggers>
                                                                        <DataTrigger Binding="{Binding Cliente}" Value="{x:Null}">
                                                                            <Setter Property="Visibility" Value="Collapsed"/>
                                                                        </DataTrigger>
                                                                    </Style.Triggers>
                                                                </Style>
                                                            </TextBlock.Style>
                                                        </TextBlock>
                                                        <TextBlock Text="{Binding Cliente.NomeCompleto}" FontSize="12" Foreground="#605E5C">
                                                            <TextBlock.Style>
                                                                <Style TargetType="TextBlock">
                                                                    <Style.Triggers>
                                                                        <DataTrigger Binding="{Binding Cliente}" Value="{x:Null}">
                                                                            <Setter Property="Visibility" Value="Collapsed"/>
                                                                        </DataTrigger>
                                                                    </Style.Triggers>
                                                                </Style>
                                                            </TextBlock.Style>
                                                        </TextBlock>

                                                        <TextBlock Text="🏠" FontSize="12" Margin="16,0,4,0">
                                                            <TextBlock.Style>
                                                                <Style TargetType="TextBlock">
                                                                    <Style.Triggers>
                                                                        <DataTrigger Binding="{Binding Immobile}" Value="{x:Null}">
                                                                            <Setter Property="Visibility" Value="Collapsed"/>
                                                                        </DataTrigger>
                                                                    </Style.Triggers>
                                                                </Style>
                                                            </TextBlock.Style>
                                                        </TextBlock>
                                                        <TextBlock Text="{Binding Immobile.Titolo}" FontSize="12" Foreground="#605E5C">
                                                            <TextBlock.Style>
                                                                <Style TargetType="TextBlock">
                                                                    <Style.Triggers>
                                                                        <DataTrigger Binding="{Binding Immobile}" Value="{x:Null}">
                                                                            <Setter Property="Visibility" Value="Collapsed"/>
                                                                        </DataTrigger>
                                                                    </Style.Triggers>
                                                                </Style>
                                                            </TextBlock.Style>
                                                        </TextBlock>
                                                    </StackPanel>
                                                </StackPanel>

                                                <!-- Azioni rapide -->
                                                <StackPanel Grid.Column="2" Orientation="Horizontal" VerticalAlignment="Top">
                                                    <Button Content="✏️" 
                    Command="{Binding DataContext.EditAppuntamentoCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                    CommandParameter="{Binding}"
                    Width="32" Height="32"
                    ToolTip="Modifica"
                    Margin="0,0,4,0"
                    Style="{StaticResource OutlookToolbarButton}"/>

                                                    <Button Content="✅" 
                    Command="{Binding DataContext.CompletaAppuntamentoCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                    Width="32" Height="32"
                    ToolTip="Completa"
                    Background="#107C10"
                    Foreground="White">
                                                        <Button.Style>
                                                            <Style TargetType="Button" BasedOn="{StaticResource OutlookToolbarButton}">
                                                                <Style.Triggers>
                                                                    <DataTrigger Binding="{Binding StatoAppuntamento}" Value="Completato">
                                                                        <Setter Property="Visibility" Value="Collapsed"/>
                                                                    </DataTrigger>
                                                                </Style.Triggers>
                                                            </Style>
                                                        </Button.Style>
                                                    </Button>
                                                </StackPanel>
                                            </Grid>

                                            <!-- Trigger per evidenziazione e animazioni -->
                                            <Border.Style>
                                                <Style TargetType="Border">
                                                    <Style.Triggers>
                                                        <!-- Appuntamento selezionato -->
                                                        <DataTrigger Binding="{Binding DataContext.SelectedAppuntamentoInCalendar, RelativeSource={RelativeSource AncestorType=UserControl}}" Value="{Binding}">
                                                            <Setter Property="BorderBrush" Value="#0078D4"/>
                                                            <Setter Property="BorderThickness" Value="2"/>
                                                            <Setter Property="Effect">
                                                                <Setter.Value>
                                                                    <DropShadowEffect Color="#0078D4" Opacity="0.4" ShadowDepth="0" BlurRadius="12"/>
                                                                </Setter.Value>
                                                            </Setter>
                                                            <!-- Animazione di selezione -->
                                                            <DataTrigger.EnterActions>
                                                                <BeginStoryboard>
                                                                    <Storyboard>
                                                                        <DoubleAnimation Storyboard.TargetProperty="(Border.RenderTransform).(ScaleTransform.ScaleX)"
                                               To="1.02" Duration="0:0:0.2">
                                                                            <DoubleAnimation.EasingFunction>
                                                                                <BackEase EasingMode="EaseOut"/>
                                                                            </DoubleAnimation.EasingFunction>
                                                                        </DoubleAnimation>
                                                                        <DoubleAnimation Storyboard.TargetProperty="(Border.RenderTransform).(ScaleTransform.ScaleY)"
                                               To="1.02" Duration="0:0:0.2">
                                                                            <DoubleAnimation.EasingFunction>
                                                                                <BackEase EasingMode="EaseOut"/>
                                                                            </DoubleAnimation.EasingFunction>
                                                                        </DoubleAnimation>
                                                                    </Storyboard>
                                                                </BeginStoryboard>
                                                            </DataTrigger.EnterActions>
                                                            <DataTrigger.ExitActions>
                                                                <BeginStoryboard>
                                                                    <Storyboard>
                                                                        <DoubleAnimation Storyboard.TargetProperty="(Border.RenderTransform).(ScaleTransform.ScaleX)"
                                               To="1.0" Duration="0:0:0.15"/>
                                                                        <DoubleAnimation Storyboard.TargetProperty="(Border.RenderTransform).(ScaleTransform.ScaleY)"
                                               To="1.0" Duration="0:0:0.15"/>
                                                                    </Storyboard>
                                                                </BeginStoryboard>
                                                            </DataTrigger.ExitActions>
                                                        </DataTrigger>

                                                        <!-- Mouse over -->
                                                        <Trigger Property="IsMouseOver" Value="True">
                                                            <Setter Property="Effect">
                                                                <Setter.Value>
                                                                    <DropShadowEffect Color="#000000" Opacity="0.2" ShadowDepth="4" BlurRadius="16"/>
                                                                </Setter.Value>
                                                            </Setter>
                                                            <Trigger.EnterActions>
                                                                <BeginStoryboard>
                                                                    <Storyboard>
                                                                        <DoubleAnimation Storyboard.TargetProperty="(Border.RenderTransform).(ScaleTransform.ScaleX)"
                                               To="1.01" Duration="0:0:0.1"/>
                                                                        <DoubleAnimation Storyboard.TargetProperty="(Border.RenderTransform).(ScaleTransform.ScaleY)"
                                               To="1.01" Duration="0:0:0.1"/>
                                                                    </Storyboard>
                                                                </BeginStoryboard>
                                                            </Trigger.EnterActions>
                                                            <Trigger.ExitActions>
                                                                <BeginStoryboard>
                                                                    <Storyboard>
                                                                        <DoubleAnimation Storyboard.TargetProperty="(Border.RenderTransform).(ScaleTransform.ScaleX)"
                                               To="1.0" Duration="0:0:0.1"/>
                                                                        <DoubleAnimation Storyboard.TargetProperty="(Border.RenderTransform).(ScaleTransform.ScaleY)"
                                               To="1.0" Duration="0:0:0.1"/>
                                                                    </Storyboard>
                                                                </BeginStoryboard>
                                                            </Trigger.ExitActions>
                                                        </Trigger>
                                                    </Style.Triggers>
                                                </Style>
                                            </Border.Style>
                                        </Border>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>
                        </ScrollViewer>
                    </Grid>
                </Grid>
            </Border>

            <GridSplitter Grid.Column="3" HorizontalAlignment="Stretch" Background="#E1DFDD"/>

            <!-- Event Details Panel -->
            <Border Grid.Column="4" Background="White" BorderBrush="#E1DFDD" BorderThickness="1,0,0,0">
                <ScrollViewer VerticalScrollBarVisibility="Auto">
                    <Grid Margin="20">
                        <!-- Placeholder when no appointment selected -->
                        <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center">
                            <StackPanel.Style>
                                <Style TargetType="StackPanel">
                                    <Setter Property="Visibility" Value="Collapsed"/>
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding SelectedAppuntamento}" Value="{x:Null}">
                                            <Setter Property="Visibility" Value="Visible"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </StackPanel.Style>
                            <Ellipse Width="64" Height="64" Fill="#E1DFDD" Margin="0,0,0,16"/>
                            <TextBlock Text="Seleziona un evento" FontSize="16" HorizontalAlignment="Center" 
                                       Foreground="#605E5C" Margin="0,0,0,5" FontWeight="SemiBold"/>
                            <TextBlock Text="Fai doppio clic su un evento nel calendario per visualizzarne i dettagli e modificarlo" 
                                       FontSize="13" HorizontalAlignment="Center" 
                                       Foreground="#8A8886" TextAlignment="Center" TextWrapping="Wrap"/>
                        </StackPanel>

                        <!-- Event Details Form -->
                        <StackPanel DataContext="{Binding SelectedAppuntamento}">
                            <StackPanel.Style>
                                <Style TargetType="StackPanel">
                                    <Setter Property="Visibility" Value="Visible"/>
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding}" Value="{x:Null}">
                                            <Setter Property="Visibility" Value="Collapsed"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </StackPanel.Style>

                            <!-- Event Header -->
                            <Border Background="{Binding StatoColore}" CornerRadius="4" Padding="12" Margin="0,0,0,20">
                                <StackPanel>
                                    <TextBlock Text="EVENTO" FontSize="10" FontWeight="Bold" Foreground="White" Opacity="0.8"/>
                                    <TextBlock Text="{Binding Titolo}" FontSize="16" FontWeight="SemiBold" Foreground="White" TextWrapping="Wrap"/>
                                    <TextBlock Text="{Binding DataInizio, StringFormat='{}{0:dddd, dd MMMM yyyy HH:mm}'}" 
                                               FontSize="12" Foreground="White" Opacity="0.9" Margin="0,4,0,0"/>
                                </StackPanel>
                            </Border>

                            <!-- Title -->
                            <TextBlock Text="Titolo" Style="{StaticResource OutlookFormLabel}"/>
                            <TextBox Text="{Binding Titolo, UpdateSourceTrigger=PropertyChanged, Mode=TwoWay}"
                                     Style="{StaticResource OutlookFormTextBox}"/>

                            <!-- Date and Time -->
                            <TextBlock Text="Data e ora" Style="{StaticResource OutlookFormLabel}"/>
                            <Grid Margin="0,0,0,12">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>

                                <StackPanel Grid.Column="0" Margin="0,0,8,0">
                                    <TextBlock Text="Inizio" FontSize="11" Foreground="#605E5C" Margin="0,0,0,2"/>
                                    <DatePicker SelectedDate="{Binding DataInizio, Mode=TwoWay}" Height="32"/>
                                    <TextBox Text="{Binding DataInizio, StringFormat=HH:mm, Mode=TwoWay}" 
                                             Height="32" Margin="0,4,0,0" 
                                             Style="{StaticResource OutlookFormTextBox}"/>
                                </StackPanel>

                                <StackPanel Grid.Column="1" Margin="8,0,0,0">
                                    <TextBlock Text="Fine" FontSize="11" Foreground="#605E5C" Margin="0,0,0,2"/>
                                    <DatePicker SelectedDate="{Binding DataFine, Mode=TwoWay}" Height="32"/>
                                    <TextBox Text="{Binding DataFine, StringFormat=HH:mm, Mode=TwoWay}" 
                                             Height="32" Margin="0,4,0,0"
                                             Style="{StaticResource OutlookFormTextBox}"/>
                                </StackPanel>
                            </Grid>

                            <!-- Location -->
                            <TextBlock Text="Luogo" Style="{StaticResource OutlookFormLabel}"/>
                            <TextBox Text="{Binding Luogo, UpdateSourceTrigger=PropertyChanged, Mode=TwoWay}"
                                     Style="{StaticResource OutlookFormTextBox}"/>

                            <!-- Type, Status and Priority -->
                            <Grid Margin="0,0,0,12">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>

                                <StackPanel Grid.Row="0" Grid.Column="0" Margin="0,0,8,0">
                                    <TextBlock Text="Tipo" Style="{StaticResource OutlookFormLabel}"/>
                                    <ComboBox ItemsSource="{Binding DataContext.TipiAppuntamento, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                              SelectedItem="{Binding TipoAppuntamento, Mode=TwoWay}"
                                              Style="{StaticResource OutlookFormComboBox}"/>
                                </StackPanel>

                                <StackPanel Grid.Row="0" Grid.Column="1" Margin="8,0,0,0">
                                    <TextBlock Text="Stato" Style="{StaticResource OutlookFormLabel}"/>
                                    <ComboBox ItemsSource="{Binding DataContext.StatiAppuntamento, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                              SelectedItem="{Binding StatoAppuntamento, Mode=TwoWay}"
                                              Style="{StaticResource OutlookFormComboBox}"/>
                                </StackPanel>

                                <StackPanel Grid.Row="1" Grid.Column="0" Grid.ColumnSpan="2" Margin="0,0,0,0">
                                    <TextBlock Text="Priorità" Style="{StaticResource OutlookFormLabel}"/>
                                    <ComboBox ItemsSource="{Binding DataContext.PrioritaAppuntamento, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                              SelectedItem="{Binding Priorita, Mode=TwoWay}"
                                              Style="{StaticResource OutlookFormComboBox}"/>
                                </StackPanel>
                            </Grid>

                            <!-- Cliente -->
                            <TextBlock Text="Cliente" Style="{StaticResource OutlookFormLabel}"/>
                            <ComboBox ItemsSource="{Binding DataContext.ClientiDisponibili, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                      SelectedValue="{Binding ClienteId, Mode=TwoWay}"
                                      SelectedValuePath="Id"
                                      DisplayMemberPath="NomeCompleto"
                                      Style="{StaticResource OutlookFormComboBox}"/>

                            <!-- Immobile -->
                            <TextBlock Text="Immobile" Style="{StaticResource OutlookFormLabel}"/>
                            <ComboBox ItemsSource="{Binding DataContext.ImmobiliDisponibili, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                      SelectedValue="{Binding ImmobileId, Mode=TwoWay}"
                                      SelectedValuePath="Id"
                                      DisplayMemberPath="Titolo"
                                      Style="{StaticResource OutlookFormComboBox}"/>

                            <!-- Description -->
                            <TextBlock Text="Descrizione" Style="{StaticResource OutlookFormLabel}"/>
                            <TextBox Text="{Binding Descrizione, UpdateSourceTrigger=PropertyChanged, Mode=TwoWay}"
                                     Style="{StaticResource OutlookFormTextBox}"
                                     Height="80" 
                                     TextWrapping="Wrap" 
                                     AcceptsReturn="True"
                                     VerticalScrollBarVisibility="Auto"/>

                            <!-- Private Notes -->
                            <TextBlock Text="Note private" Style="{StaticResource OutlookFormLabel}"/>
                            <TextBox Text="{Binding NotePrivate, UpdateSourceTrigger=PropertyChanged, Mode=TwoWay}"
                                     Style="{StaticResource OutlookFormTextBox}"
                                     Height="60" 
                                     TextWrapping="Wrap" 
                                     AcceptsReturn="True"
                                     VerticalScrollBarVisibility="Auto"/>

                            <!-- Quick Actions -->
                            <TextBlock Text="Azioni" Style="{StaticResource OutlookFormLabel}" Margin="0,12,0,4"/>
                            <StackPanel Orientation="Horizontal" Margin="0,0,0,12">
                                <Button Content="💾 Salva" 
                                        Command="{Binding DataContext.SaveAppuntamentoCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                        Background="#0078D4"
                                        Foreground="White"
                                        Margin="0,0,8,0"
                                        Style="{StaticResource OutlookToolbarButton}"/>

                                <Button Content="✅ Conferma" 
                                        Command="{Binding DataContext.ConfermaAppuntamentoCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                        Background="#107C10"
                                        Foreground="White"
                                        Margin="0,0,8,0">
                                    <Button.Style>
                                        <Style TargetType="Button" BasedOn="{StaticResource OutlookToolbarButton}">
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding StatoAppuntamento}" Value="Confermato">
                                                    <Setter Property="IsEnabled" Value="False"/>
                                                </DataTrigger>
                                                <DataTrigger Binding="{Binding StatoAppuntamento}" Value="Completato">
                                                    <Setter Property="IsEnabled" Value="False"/>
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </Button.Style>
                                </Button>

                                <Button Content="🗑️ Elimina" 
                                        Command="{Binding DataContext.DeleteAppuntamentoCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                        Background="#D83B01"
                                        Foreground="White"
                                        Style="{StaticResource OutlookToolbarButton}"/>
                            </StackPanel>

                            <!-- Status Info -->
                            <Border Background="#F8F8F8" 
                                    BorderBrush="#E1DFDD" 
                                    BorderThickness="1" 
                                    CornerRadius="4" 
                                    Padding="12" 
                                    Margin="0,12,0,0">
                                <StackPanel>
                                    <TextBlock Text="Informazioni evento" 
                                               FontWeight="SemiBold" 
                                               FontSize="13" 
                                               Foreground="#323130" 
                                               Margin="0,0,0,8"/>
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="Auto"/>
                                            <ColumnDefinition Width="*"/>
                                        </Grid.ColumnDefinitions>
                                        <Grid.RowDefinitions>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="Auto"/>
                                        </Grid.RowDefinitions>

                                        <TextBlock Grid.Row="0" Grid.Column="0" Text="ID:" FontSize="11" Foreground="#605E5C" Margin="0,0,8,2"/>
                                        <TextBlock Grid.Row="0" Grid.Column="1" Text="{Binding Id}" FontSize="11" Foreground="#605E5C" Margin="0,0,0,2"/>

                                        <TextBlock Grid.Row="1" Grid.Column="0" Text="Durata:" FontSize="11" Foreground="#605E5C" Margin="0,0,8,2"/>
                                        <TextBlock Grid.Row="1" Grid.Column="1" Text="{Binding DurataFormattata}" FontSize="11" Foreground="#605E5C" Margin="0,0,0,2"/>

                                        <TextBlock Grid.Row="2" Grid.Column="0" Text="Creato:" FontSize="11" Foreground="#605E5C" Margin="0,0,8,2"/>
                                        <TextBlock Grid.Row="2" Grid.Column="1" Text="{Binding DataCreazione, StringFormat=dd/MM/yyyy HH:mm}" FontSize="11" Foreground="#605E5C" Margin="0,0,0,2"/>

                                        <TextBlock Grid.Row="3" Grid.Column="0" Text="Modificato:" FontSize="11" Foreground="#605E5C" Margin="0,0,8,0"/>
                                        <TextBlock Grid.Row="3" Grid.Column="1" Text="{Binding DataUltimaModifica, StringFormat=dd/MM/yyyy HH:mm, FallbackValue=Mai}" FontSize="11" Foreground="#605E5C"/>
                                    </Grid>
                                </StackPanel>
                            </Border>
                        </StackPanel>
                    </Grid>
                </ScrollViewer>
            </Border>
        </Grid>
    </Grid>
</UserControl>